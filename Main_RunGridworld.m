% run maze experiments
close all
clear all
clc

limits = [-0.4 -0.2; 
          0.2 0.4;];
% build the maze
maze = CMazeMaze10x10(limits);
% draw the maze
maze.DrawMaze();

% build the transition matrix
maze = maze.BuildTransitionMatrix();



for i =1:1000
    % test random start
    startingState(i,:) = maze.RandomStatingState();
    
end


% print out value
figure;
hold on;
histogram(startingState,'BinWidth',1);
title('10580008: Histogram showing starting state')

episodes=500;
trialCnt=100;
alpha =0.2;
gamma =0.9;
explorationRate = 0.2;
for trial = 1:trialCnt
[Q steps(:, trial)] = Trial(alpha, gamma, episodes, explorationRate,maze);
end

[visitedStates, stateCords] = ExploitQ(Q,maze);
figure;
hold on;
maze.DrawMaze();


for i =1:size(visitedStates,2)

   x = stateCords(1,i);
   y = stateCords(2,i);
   scaledCords(1,i) = maze.textLowerPoint(x,y,1);
   scaledCords(2,i) = maze.textLowerPoint(x,y,2);
   if(i<size(visitedStates,2))
   x2 = stateCords(1,i+1);
   y2 = stateCords(2,i+1);
   end
   
   plot(maze.textLowerPoint(x,y,1),maze.textLowerPoint(x,y,2),'mx','linewidth',5);
   plot([maze.textLowerPoint(x,y,1);maze.textLowerPoint(x2,y2,1)],[maze.textLowerPoint(x,y,2);maze.textLowerPoint(x2,y2,2)],'-m','linewidth',3);
end




figure
hold on
msteps = mean(steps,2);
ssteps = std(steps'); 
errorbar(1:length(msteps), msteps, ssteps);
title('10580008: Q-learning in operation across multiple trials')
xlabel('Episode Number');
ylabel('Number of Steps');


% weight1 = [3.56118427767753,3.07482207473753,2.89482896266409;0.693775468982153,2.39397504394704,0.0291575345567741;1.77906168072570,3.05549538065357,-1.61757962468965;1.31587825813497,-0.828202352000606,-3.28473994245711;1.98787005971057,3.92597224485435,0.962403053984495;3.67672581224451,3.05063425081000,5.49192773838922;3.78251320379044,0.892396670503918,-4.60848541771339;3.27113068657149,1.08708357691529,-4.15448361100892;2.44317868429971,0.719297922182373,1.67862163187732;1.45880832817123,0.00894284451129102,5.18046015626329;2.19744581832332,-0.106429965743828,-1.32335600041980;5.34968007273451,1.07718307738693,-4.80287589120647;1.68330817705443,-1.07681056634130,0.144323434080826;0.162564379679006,1.79917754911166,5.83758757607458;1.27340955906748,2.33030430068725,3.16939183959592;3.12609989006234,0.627148146775387,0.752008789607178;1.48835187577950,0.234461003760245,0.545408104107721;2.02485631527147,-0.344946231998077,0.892101567898116;2.34125282737107,3.40447817096273,-1.46100775777018;0.949565325725928,-0.166742024199667,-0.716256455150311;2.70733817558806,0.00893743635829899,-5.02483201296527;0.851624368822674,1.73047150997398,3.27977107115993;1.39034582346305,0.205429108396060,-3.62401367680978;5.87197844465089,2.98766222930100,2.32414842302990;4.60563837603705,-0.773251190390946,-0.355876622561068;0.975482915850085,0.654955682181595,0.297038221819418;2.02865657104175,0.280790260740948,-0.849721534360253;0.453871730610894,4.69960212809785,3.22755167898143;2.38935336259728,0.350041438361772,-3.53813127710106;2.68988154504123,0.0158835008120152,-3.59220295536368];
 %weight2 = [-1.18404104525990,-0.461723195163943,-0.431351083497270,-0.466719330380540,-0.634893454697676,-0.473816953853181,2.01639410236129,2.47236588665672,0.785444231061112,-0.535371525079647,-0.0374877153883310,3.88904185226710,-2.13637116876377,2.00802825357136,1.44452889601097,-1.65541256885141,-0.226902229896484,-0.570706084343790,-0.363406404581468,-0.0506629213424792,1.39013997780738,-0.467715449850882,1.18691884639128,-0.0564934081866690,0.411499672411312,-0.0619885056031409,-0.676545840727725,1.00334476666086,3.34980358400842,2.14001196387523,1.95256063466205;-0.680237355586744,-1.73893176422940,-0.276272518687850,3.55836751330727,-0.293549996119908,0.000718519923946877,1.65789058864091,0.308473101730191,0.143157679678368,0.801860762169201,-0.564131836065722,1.50669978364666,1.22797753754103,-1.00021956819519,-1.03137900697446,0.671623203875300,-1.08334180026106,1.22193000331925,-0.763359728455446,-0.0608480424432483,3.75184604490829,2.42523087364209,0.850535523504481,1.16577002518772,1.56475802279843,-0.157075874604273,-0.571523016597355,-1.44914271365775,-0.398999852956421,0.140045721171129,2.62307846721905];

 %weight1 = [1.34493249426204,5.69638651423117,-2.05741714802704;-0.731124508825874,0.0944144070523175,3.23784542605038;4.50079063483176,3.70501721730030,0.159371862440424;2.49107068920971,3.09033120713633,-0.309482121066517;2.71931433474958,0.806883665751861,-3.17339474897865;1.11270574678380,1.77986463253701,-0.195195732036804;-2.07264152245821,1.91816762262616,3.20526843941002;-2.99254777502073,-3.86777028520104,0.640245833113458;4.43845277960028,-0.734198971055886,2.67725462953507;1.21909388095109,0.304257241544798,4.60553087547269];
 %weight2 = [4.98527264991316,0.399716780750957,-0.428349501168506,-3.66587319969551,0.103286527549167,-0.515258122865581,1.35726107141634,3.41691816115695,1.35135144253979,-1.32467583490636,-1.55073204239294;-0.990071058319356,2.38051011977610,3.18397885425412,-0.617810801917638,1.61818188619732,4.08115205233016,-2.05363172193824,5.26126346586137,2.29312612900663,-2.58327986267439,-3.56033050344035];
% weight1 = [3.56118427767753,3.07482207473753,2.89482896266409;0.693775468982153,2.39397504394704,0.0291575345567741;1.77906168072570,3.05549538065357,-1.61757962468965;1.31587825813497,-0.828202352000606,-3.28473994245711;1.98787005971057,3.92597224485435,0.962403053984495;3.67672581224451,3.05063425081000,5.49192773838922;3.78251320379044,0.892396670503918,-4.60848541771339;3.27113068657149,1.08708357691529,-4.15448361100892;2.44317868429971,0.719297922182373,1.67862163187732;1.45880832817123,0.00894284451129102,5.18046015626329;2.19744581832332,-0.106429965743828,-1.32335600041980;5.34968007273451,1.07718307738693,-4.80287589120647;1.68330817705443,-1.07681056634130,0.144323434080826;0.162564379679006,1.79917754911166,5.83758757607458;1.27340955906748,2.33030430068725,3.16939183959592;3.12609989006234,0.627148146775387,0.752008789607178;1.48835187577950,0.234461003760245,0.545408104107721;2.02485631527147,-0.344946231998077,0.892101567898116;2.34125282737107,3.40447817096273,-1.46100775777018;0.949565325725928,-0.166742024199667,-0.716256455150311;2.70733817558806,0.00893743635829899,-5.02483201296527;0.851624368822674,1.73047150997398,3.27977107115993;1.39034582346305,0.205429108396060,-3.62401367680978;5.87197844465089,2.98766222930100,2.32414842302990;4.60563837603705,-0.773251190390946,-0.355876622561068;0.975482915850085,0.654955682181595,0.297038221819418;2.02865657104175,0.280790260740948,-0.849721534360253;0.453871730610894,4.69960212809785,3.22755167898143;2.38935336259728,0.350041438361772,-3.53813127710106;2.68988154504123,0.0158835008120152,-3.59220295536368];
% weight2 = [-1.18404104525990,-0.461723195163943,-0.431351083497270,-0.466719330380540,-0.634893454697676,-0.473816953853181,2.01639410236129,2.47236588665672,0.785444231061112,-0.535371525079647,-0.0374877153883310,3.88904185226710,-2.13637116876377,2.00802825357136,1.44452889601097,-1.65541256885141,-0.226902229896484,-0.570706084343790,-0.363406404581468,-0.0506629213424792,1.39013997780738,-0.467715449850882,1.18691884639128,-0.0564934081866690,0.411499672411312,-0.0619885056031409,-0.676545840727725,1.00334476666086,3.34980358400842,2.14001196387523,1.95256063466205;-0.680237355586744,-1.73893176422940,-0.276272518687850,3.55836751330727,-0.293549996119908,0.000718519923946877,1.65789058864091,0.308473101730191,0.143157679678368,0.801860762169201,-0.564131836065722,1.50669978364666,1.22797753754103,-1.00021956819519,-1.03137900697446,0.671623203875300,-1.08334180026106,1.22193000331925,-0.763359728455446,-0.0608480424432483,3.75184604490829,2.42523087364209,0.850535523504481,1.16577002518772,1.56475802279843,-0.157075874604273,-0.571523016597355,-1.44914271365775,-0.398999852956421,0.140045721171129,2.62307846721905];
% weight1 = [-0.654067575929347,-0.314858000566737,0.275367220831356;0.190378694464478,-0.137369094752346,0.0368210602377855;0.362240689948941,0.848498254707145,-1.16564382175627;-0.143163982890878,0.00690242935337594,-1.84210908284858;-1.00860109676528,-0.250923404703907,0.718325928433434;0.748560309785838,0.161074362675515,-0.737075730933491;1.87968052997935,-4.91004635166002,-0.617343231331793;-3.62629460319113,-0.773403307740874,-1.66378601899336;3.01583002863445,-0.359410331963610,-2.09889840477422;0.0662895283100244,0.229251812654073,0.375698626862398;-2.18985313527976,-1.81497976650948,0.431095526770940;2.54018636288919,-1.99668565798033,2.06544414362089;0.156768038389446,-1.19491238347942,0.0999367588303988;-0.554423289147571,-4.19600927203189,3.07063769635549;0.987647659881047,0.920120983533636,0.613615453133032;0.783495376868932,-0.558851329866207,-0.158222020288941;1.80436602016147,2.68686716350522,-2.25928399466588;0.842441809898918,-1.00771119026219,-0.584991718273368;-1.28052895715078,0.479675672232761,-0.889262695025249;-0.143143481913064,0.326545636949961,0.269321044367190];
 %weight2 = [0.678659528543136,0.117069039723849,0.319626929336735,-0.428444870317078,0.831997089228796,-0.130660271003590,3.52710488094233,1.61792948247115,-1.04308428918542,0.724730827498526,1.45388701402581,-1.14356651102514,0.400339684457010,-2.71474632778030,-1.10288940687800,0.352892978197805,1.01992025305643,1.11477944054023,0.720397583864414,0.785688428431437,0.578032500440040;0.279637151602186,0.674033844000366,-0.488196817799061,0.900836836069298,0.247107879197846,-0.734787619882777,-1.73651565989702,-4.29541088894459,-3.18274617756526,-0.150875453945557,1.11385530931280,2.35231948201464,0.706455554667992,2.07858985092425,0.347546247684121,-0.420658113330774,-3.05588051341079,-1.00565729688439,-1.48500267300720,-0.781138602430537,0.528510450831100];
 weight1 = [-2.87688742643081,1.66886386545572,1.38387263181689;4.25530924305401,1.04061179280413,1.63685347835352;4.37931232102114,0.235758629751348,-2.20249916430116;3.87981528915934,1.78058933632444,-0.271344701441490;1.38994461717167,2.35307955359429,-1.61722515939146;-0.729105591607400,6.46472172811485,-2.15114051390764;2.10487338144522,2.34277446471463,-2.68365347341128;-1.37441682001485,3.34257921264207,2.70861298813770;0.0168705388302923,1.45553044114723,2.10195571847571;1.75232295441105,2.18824507990065,0.470282683964186;0.560001394694880,2.91867810737402,-0.849745758532833;-0.136553368541137,-2.20057290498717,-1.02004662519899;1.67987093553600,0.337607785116821,-1.05555293593160;1.89661036612888,5.48486275499637,0.252074909953646;6.13811199447777,3.21455471926193,-0.275684062266473;0.228410755619583,0.787388525061372,-1.63046712596808;1.01277779878275,1.34165814422113,1.26111528526970;1.16450182399636,1.15686320357923,-0.00450861040164619;-3.07551978104657,0.0673086950364740,3.07292710369575;-1.11727014503026,1.17004173152639,0.402507110141964;1.94422735346909,1.83874505377291,0.0694766460034470;1.87265529411654,0.997888880221877,-0.507725013641830;1.06257996732364,2.16914273151080,5.15398726942660;-0.881180927583025,0.815828804150144,2.58553134790059;0.858895630442393,-4.03226506552119,5.63908390964452;-0.411954736206614,1.60228436298086,0.311512534739685;-2.92137270667239,2.46602035538514,1.61295499684588;0.709856920696692,0.984036950047035,3.74195456724704;-2.71764977492392,-2.76401107165941,1.95630160512070;2.33638394669107,-0.124684489694955,3.33522209428410];
 weight2 = [-0.786086900592124,-3.52887477720329,2.37110977187670,-1.82150798393814,0.226880553749779,1.79987073182687,3.33047847924537,2.51703639794211,1.65655131577640,0.111258780440864,-0.362373988662684,4.57723357115843,-0.657450526394118,-0.486800931572861,1.22744640639020,2.00776015448610,-0.285529222983139,0.388262351103930,-3.54004371117675,-0.222725502843158,3.78304324912125,-1.63674624559757,3.14501428495895,0.0922403329858206,-1.58368396967672,-1.20127521864004,1.04637055312103,0.892283062487700,-1.25434382628404,-1.99518353664926,1.36584259865936;1.02941493592284,0.175815885192277,1.74383075981456,-1.20769592842319,0.264186651696363,0.336900911006605,0.226676566636137,-1.28511520999514,1.82742520538089,-2.32499817321951,1.78360356018266,1.75573937411556,2.98132604191882,0.306148322744497,1.28637554545048,3.81975482749265,1.34476218992252,-1.55147760210532,0.451324208479743,0.421710723220709,2.68616101479845,1.60892038055532,-3.01778226993458,-0.424667579668380,2.41577315110066,-2.53799356329502,-0.734383528276892,3.05160042899709,1.70764656408821,-2.38357079349048,-2.57573183975611];
 
 
 %run network and get weights
[weight1, weight2] = neuralNetwork();
%use the network with scaled cordinates of the path through the maze
angles = useNetwork(scaledCords,weight1,weight2,size(visitedStates,2));

armLen = [0.4,0.4];
origin = [0,0];
%pass parameters into forward kinematics model
[aP1,aP2] = RevoluteForwardKinematics2D(armLen, angles, origin);


%plot points
figure;
grid on;
hold on;
maze.DrawMaze();
pause(5);
for i =1:size(visitedStates,2)
    plot(0,0,'g*','LineWidth',2); %origin
    plot(aP1(1,i),aP1(2,i),'mo','LineWidth',2); %point 1
    plot(aP2(1,i),aP2(2,i),'co','LineWidth',2); %point 2
    plot([0;aP1(1,i)],[0;aP1(2,i)],'-b'); %line from origin to point 1
    plot([aP1(1,i);aP2(1,i)],[aP1(2,i);aP2(2,i)],'-b'); %line from point 2 to point 1
    pause(0.5);
end

title('10580008: Arm Configuration');
ylabel('Y[m]');
xlabel('X[M]');
hold off;


%plot regenerated
figure;
hold on;
grid on;
plot(aP2(1,:),aP2(2,:),'m.');



% figure
% hold on
% title('Q function table values')
% surf(Q);
% xlabel('Action');
% ylabel('States');
% zlabel('Q value');
% axis([1 4 1 11 0 1])
% view(3);




